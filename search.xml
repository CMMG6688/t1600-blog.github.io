<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Ubuntu调整Swap分区大小</title>
      <link href="/2023/12/01/Ubuntu%E8%B0%83%E6%95%B4SWAP%E5%88%86%E5%8C%BA%E5%A4%A7%E5%B0%8F/"/>
      <url>/2023/12/01/Ubuntu%E8%B0%83%E6%95%B4SWAP%E5%88%86%E5%8C%BA%E5%A4%A7%E5%B0%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu-Swap-分区"><a href="#Ubuntu-Swap-分区" class="headerlink" title="Ubuntu Swap 分区"></a>Ubuntu Swap 分区</h1><blockquote><p>Swap分区指的就是linux的交换分区<br>Swap分区在系统的物理内存不够用的时候，把硬盘内存中的一部分空间释放出来，以供当前运行的程序使用。那些被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间被临时保存到Swap分区中，等到那些程序要运行时，再从Swap分区中恢复保存的数据到内存中。<br>Ubuntu 20.04安装后，默认的Swap分区容量是2GB，在编译代码时存在交换分区容量不足，导致编译失败的情况，下面展示了调整Swap分区大小到8G的过程。</p></blockquote><h1 id="调整Swap分区大小"><a href="#调整Swap分区大小" class="headerlink" title="调整Swap分区大小"></a>调整Swap分区大小</h1><h2 id="1-首先用ssh连接上Ubuntu服务器"><a href="#1-首先用ssh连接上Ubuntu服务器" class="headerlink" title="1.首先用ssh连接上Ubuntu服务器"></a>1.首先用ssh连接上Ubuntu服务器</h2><p>查看内存分区大小可以用<code>free -m</code>或<code>free -h</code>命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@zhao:~# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.8Gi       690Mi       2.7Gi       1.6Mi       640Mi       3.1Gi</span><br><span class="line">Swap:          3.8Gi          0B       3.8Gi</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里可以看到swap分区大小为3.8G</p><h2 id="2-关闭SWAP分区"><a href="#2-关闭SWAP分区" class="headerlink" title="2.关闭SWAP分区"></a>2.关闭SWAP分区</h2><p>先查找<code>swap文件</code>的位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@zhao:~# swapon --show</span><br><span class="line">NAME      TYPE SIZE USED PRIO</span><br><span class="line">/swap.img file 3.8G   0B   -2</span><br></pre></td></tr></table></figure><p>可见位置在根目录下，这时我们关闭swap分区，然后再看内存分区大小</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@zhao:~# swapoff /swap.img </span><br><span class="line"></span><br><span class="line">root@zhao:~# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.8Gi       680Mi       2.7Gi       1.6Mi       641Mi       3.1Gi</span><br><span class="line">Swap:             0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-调整-swap-img到8GB，并格式化"><a href="#3-调整-swap-img到8GB，并格式化" class="headerlink" title="3.调整&#x2F;swap.img到8GB，并格式化"></a>3.调整&#x2F;swap.img到8GB，并格式化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@zhao:~# fallocate -l 8G /swap.img </span><br><span class="line"></span><br><span class="line">root@zhao:~# chmod 600 /swap.img </span><br><span class="line"></span><br><span class="line">root@zhao:~# mkswap /swap.img</span><br><span class="line">mkswap: /swap.img: warning: wiping old swap signature.</span><br><span class="line">Setting up swapspace version 1, size = 8 GiB (8589930496 bytes)</span><br><span class="line">no label, UUID=535c80d4-c681-4067-b254-dcac37e84b51</span><br></pre></td></tr></table></figure><h2 id="4-启用SWAP分区，再查看内存分区大小"><a href="#4-启用SWAP分区，再查看内存分区大小" class="headerlink" title="4.启用SWAP分区，再查看内存分区大小"></a>4.启用SWAP分区，再查看内存分区大小</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@zhao:~# swapon /swap.img</span><br><span class="line"></span><br><span class="line">root@zhao:~# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.8Gi       686Mi       2.7Gi       1.6Mi       644Mi       3.1Gi</span><br><span class="line">Swap:          8.0Gi          0B       8.0Gi</span><br></pre></td></tr></table></figure><p>此时，swap已经成功更改为8G</p><h2 id="5-持久化（如果重启后丢失更改）-可选"><a href="#5-持久化（如果重启后丢失更改）-可选" class="headerlink" title="5.持久化（如果重启后丢失更改）(可选)"></a>5.持久化（如果重启后丢失更改）(可选)</h2><p>你可以通过将新创建的交换文件添加到<code>/etc/fstab</code>文件来使更改持久化。<br>注意：对<code>/etc/fstab</code>文件进行任何更改之前，最好先进行备份。</p><pre><code>root@zhao:~# cp /etc/fstab /etc/fstab.bak</code></pre><p>首先先打开<code>/etc/fstab</code>文件，这里可以用<code>vim</code>来操作</p><pre><code>root@zhao:~# vim /etc/fstab</code></pre><p>将<code>/swap.img none swap sw 0 0</code>添加到<code>/etc/fstab</code>文件的末尾<br>当然也可以用以下命令一键添加</p><pre><code>echo &#39;/swap.img none swap sw 0 0&#39; | sudo tee -a /etc/fstab</code></pre><p>现在一切都准备好了。即使在重新启动你的 Linux 系统后，你的交换文件也会被使用。</p><h2 id="6-调整-swappiness-参数-可选"><a href="#6-调整-swappiness-参数-可选" class="headerlink" title="6.调整 swappiness 参数(可选)"></a>6.调整 swappiness 参数(可选)</h2><p>swappiness 参数决定了交换空间的使用频率。swappiness值的范围从0到100。较高的值意味着交换空间将被更频繁地使用。Ubuntu系统默认的swappiness是60。<br>你可以使用以下命令检查swappiness的值</p><pre><code>root@VM-4-13-ubuntu:~# cat /proc/sys/vm/swappiness60</code></pre><p>你可以使用以下系统命令动态更改swappiness的值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@zhao:~# sysctl vm.swappiness=80</span><br><span class="line">vm.swappiness = 80</span><br></pre></td></tr></table></figure><p>这种改变只是暂时的。如果要使其永久化，可以编辑<code>/etc/sysctl.conf</code>文件，并在文件末尾添加swappiness值:</p><pre><code>vm.swappiness=25</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="/2023/11/24/test/"/>
      <url>/2023/11/24/test/</url>
      
        <content type="html"><![CDATA[<p><strong>test</strong></p><h1 id="test"><a href="#test" class="headerlink" title="test"></a>test</h1>]]></content>
      
      
      
        <tags>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
